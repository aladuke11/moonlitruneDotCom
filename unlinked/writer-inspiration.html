<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writer's Motivation Tracker</title>
  <link rel="stylesheet" href="writer-inspiration.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1 class="main-title">Writer's Motivation Tracker</h1>
    </header>

    <main>
      <section class="cyber-grid" aria-labelledby="timer-heading">
        <h2 id="timer-heading">Writing Timer</h2>
        <div class="timer-container">
          <div class="timer-ring" aria-label="Timer progress">
            <div class="timer-display" id="timer-display">25:00</div>
          </div>
          <div class="timer-controls">
            <button class="control-btn" id="start-btn">Start</button>
            <button class="control-btn" id="pause-btn" disabled>Pause</button>
            <button class="control-btn" id="reset-btn">Reset</button>
          </div>
          <div class="time-presets">
            <button class="preset-btn" onclick="setTimer(15)">15 min</button>
            <button class="preset-btn" onclick="setTimer(25)">25 min</button>
            <button class="preset-btn" onclick="setTimer(45)">45 min</button>
            <button class="preset-btn" onclick="setTimer(60)">60 min</button>
          </div>
        </div>
      </section>

      <section class="cyber-grid">
        <h2>Today's Progress</h2>
        <div class="stats-display">
          <div class="stat-card">
            <div class="stat-number" id="sessions-today">0</div>
            <div class="stat-label">Sessions</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="time-today">0m</div>
            <div class="stat-label">Time</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-sessions">0</div>
            <div class="stat-label">Total Sessions</div>
          </div>
        </div>
      </section>

      <section class="streak-section cyber-grid" aria-labelledby="streak-heading">
        <h2 id="streak-heading">Your Writing Streak</h2>
        <div class="streak-display">
          <div class="streak-count" id="streak-count">0 days</div>
          <p class="streak-subtitle">Keep the momentum going!</p>
        </div>
        <div class="calendar-grid" aria-label="30-day progress calendar" id="calendar-grid">
          <!-- Calendar days will be generated by JavaScript -->
        </div>
      </section>

      <aside class="notes-section cyber-grid" aria-labelledby="notes-heading">
        <h2 id="notes-heading">Writing Notes & Ideas</h2>
        <textarea 
          class="notes-textarea" 
          id="notes" 
          placeholder="Jot down your story ideas, character notes, or writing reflections..."
        ></textarea>
        <div class="notes-controls">
          <button class="control-btn" id="save-notes">Save Notes</button>
          <button class="preset-btn" onclick="clearNotes()">Clear</button>
        </div>
      </aside>
    </main>

    <footer>
      <div class="footer-controls">
        <button class="preset-btn" id="export-data">Export Data</button>
        <button class="preset-btn" id="view-stats">View Stats</button>
        <button class="preset-btn" id="clear-data">Clear All Data</button>
      </div>
    </footer>
  </div>

  <script>
    // Global variables
    let timer = null;
    let timeLeft = 25 * 60; // 25 minutes in seconds
    let totalTime = 25 * 60;
    let isRunning = false;
    let isPaused = false;
    let sessionStartTime = null;

    // DOM elements
    const timerDisplay = document.getElementById('timer-display');
    const startBtn = document.getElementById('start-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const resetBtn = document.getElementById('reset-btn');
    const timerRing = document.querySelector('.timer-ring');
    const notesTextarea = document.getElementById('notes');
    const saveNotesBtn = document.getElementById('save-notes');

    // Initialize app
    function init() {
      updateTimerDisplay();
      loadNotes();
      generateCalendar();
      updateStats();
      loadStreak();
    }

    // Timer functions
    function setTimer(minutes) {
      if (!isRunning) {
        timeLeft = minutes * 60;
        totalTime = minutes * 60;
        updateTimerDisplay();
        updateTimerRing();
      }
    }

    function startTimer() {
      if (!isRunning) {
        isRunning = true;
        isPaused = false;
        sessionStartTime = new Date();
        
        timer = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();
          updateTimerRing();
          
          if (timeLeft <= 0) {
            stopTimer();
            completeSession();
          }
        }, 1000);

        startBtn.disabled = true;
        pauseBtn.disabled = false;
        startBtn.textContent = 'Running...';
      }
    }

    function pauseTimer() {
      if (isRunning && !isPaused) {
        clearInterval(timer);
        isPaused = true;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        startBtn.textContent = 'Resume';
      }
    }

    function resetTimer() {
      clearInterval(timer);
      isRunning = false;
      isPaused = false;
      timeLeft = totalTime;
      
      updateTimerDisplay();
      updateTimerRing();
      
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      startBtn.textContent = 'Start';
    }

    function stopTimer() {
      clearInterval(timer);
      isRunning = false;
      isPaused = false;
      
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      startBtn.textContent = 'Start';
    }

    function completeSession() {
      // Log completed session
      const sessionData = {
        date: new Date().toDateString(),
        duration: Math.ceil((totalTime - timeLeft) / 60), // minutes
        completed: timeLeft <= 0
      };
      
      logSession(sessionData);
      updateStreak();
      updateStats();
      
      // Notification
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('Writing Session Complete!', {
          body: `Great job! You completed a ${Math.ceil(totalTime / 60)} minute writing session.`,
          icon: '/favicon.ico'
        });
      } else {
        alert('ðŸŽ‰ Writing session complete! Great job!');
      }
      
      resetTimer();
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateTimerRing() {
      const progress = ((totalTime - timeLeft) / totalTime) * 360;
      const ring = timerRing.querySelector('::before') || timerRing;
      if (timerRing.style.setProperty) {
        timerRing.style.setProperty('--progress', `${progress}deg`);
      }
    }

    // Session logging
    function logSession(sessionData) {
      let sessions = JSON.parse(localStorage.getItem('writerSessions') || '[]');
      sessions.push(sessionData);
      localStorage.setItem('writerSessions', JSON.stringify(sessions));
    }

    function updateStats() {
      const sessions = JSON.parse(localStorage.getItem('writerSessions') || '[]');
      const today = new Date().toDateString();
      
      const todaySessions = sessions.filter(s => s.date === today);
      const totalTodayTime = todaySessions.reduce((sum, s) => sum + s.duration, 0);
      
      document.getElementById('sessions-today').textContent = todaySessions.length;
      document.getElementById('time-today').textContent = `${totalTodayTime}m`;
      document.getElementById('total-sessions').textContent = sessions.length;
    }

    // Streak management
    function updateStreak() {
      const sessions = JSON.parse(localStorage.getItem('writerSessions') || '[]');
      const today = new Date().toDateString();
      
      // Check if user wrote today
      const wroteToday = sessions.some(s => s.date === today && s.completed);
      
      if (wroteToday) {
        let streak = parseInt(localStorage.getItem('writerStreak') || '0');
        const lastStreakDate = localStorage.getItem('lastStreakDate');
        
        if (lastStreakDate !== today) {
          // Check if yesterday exists
          const yesterday = new Date();
          yesterday.setDate(yesterday.getDate() - 1);
          const yesterdayStr = yesterday.toDateString();
          
          const wroteYesterday = sessions.some(s => s.date === yesterdayStr && s.completed);
          
          if (wroteYesterday || streak === 0) {
            streak++;
          } else {
            streak = 1; // Reset streak
          }
          
          localStorage.setItem('writerStreak', streak);
          localStorage.setItem('lastStreakDate', today);
        }
      }
      
      loadStreak();
    }

    function loadStreak() {
      const streak = parseInt(localStorage.getItem('writerStreak') || '0');
      document.getElementById('streak-count').textContent = `${streak} days`;
    }

    // Calendar generation
    function generateCalendar() {
      const calendarGrid = document.getElementById('calendar-grid');
      const sessions = JSON.parse(localStorage.getItem('writerSessions') || '[]');
      const today = new Date();
      
      calendarGrid.innerHTML = '';
      
      // Generate last 30 days
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(today.getDate() - i);
        const dateStr = date.toDateString();
        
        const dayMarker = document.createElement('div');
        dayMarker.className = 'day-marker';
        dayMarker.textContent = date.getDate();
        
        // Check if user wrote on this day
        const wroteThisDay = sessions.some(s => s.date === dateStr && s.completed);
        if (wroteThisDay) {
          dayMarker.classList.add('completed');
        }
        
        // Mark today
        if (i === 0) {
          dayMarker.classList.add('today');
        }
        
        calendarGrid.appendChild(dayMarker);
      }
    }

    // Notes management
    function loadNotes() {
      const savedNotes = localStorage.getItem('writerNotes');
      if (savedNotes) {
        notesTextarea.value = savedNotes;
      }
    }

    function saveNotes() {
      localStorage.setItem('writerNotes', notesTextarea.value);
      alert('ðŸ“ Notes saved successfully!');
    }

    function clearNotes() {
      if (confirm('Are you sure you want to clear all notes?')) {
        notesTextarea.value = '';
        localStorage.removeItem('writerNotes');
      }
    }

    // Data management
    function exportData() {
      const data = {
        sessions: JSON.parse(localStorage.getItem('writerSessions') || '[]'),
        notes: localStorage.getItem('writerNotes') || '',
        streak: localStorage.getItem('writerStreak') || '0',
        lastStreakDate: localStorage.getItem('lastStreakDate') || ''
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `writer-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function viewStats() {
      const sessions = JSON.parse(localStorage.getItem('writerSessions') || '[]');
      
      if (sessions.length === 0) {
        alert('ðŸ“Š No writing sessions recorded yet. Start your first session!');
        return;
      }
      
      const totalSessions = sessions.length;
      const completedSessions = sessions.filter(s => s.completed).length;
      const totalTime = sessions.reduce((sum, s) => sum + s.duration, 0);
      const avgSession = Math.round(totalTime / totalSessions);
      
      const last7Days = sessions.filter(s => {
        const sessionDate = new Date(s.date);
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        return sessionDate >= weekAgo;
      });
      
      alert(`ðŸ“ˆ Your Writing Stats:
      
ðŸ“ Total Sessions: ${totalSessions}
âœ… Completed: ${completedSessions}
â±ï¸ Total Time: ${Math.floor(totalTime / 60)}h ${totalTime % 60}m
ðŸ“Š Average Session: ${avgSession} minutes
ðŸ“… Last 7 Days: ${last7Days.length} sessions
ðŸ”¥ Current Streak: ${localStorage.getItem('writerStreak') || '0'} days`);
    }

    function clearAllData() {
      if (confirm('âš ï¸ Are you sure you want to clear ALL data? This cannot be undone.')) {
        localStorage.removeItem('writerSessions');
        localStorage.removeItem('writerNotes');
        localStorage.removeItem('writerStreak');
        localStorage.removeItem('lastStreakDate');
        
        // Reset UI
        notesTextarea.value = '';
        updateStats();
        loadStreak();
        generateCalendar();
        
        alert('ðŸ—‘ï¸ All data cleared successfully!');
      }
    }

    // Event listeners
    startBtn.addEventListener('click', () => {
      if (isPaused) {
        startTimer();
      } else {
        startTimer();
      }
    });

    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);
    saveNotesBtn.addEventListener('click', saveNotes);
    document.getElementById('export-data').addEventListener('click', exportData);
    document.getElementById('view-stats').addEventListener('click', viewStats);
    document.getElementById('clear-data').addEventListener('click', clearAllData);

    // Auto-save notes
    notesTextarea.addEventListener('input', () => {
      clearTimeout(notesTextarea.saveTimeout);
      notesTextarea.saveTimeout = setTimeout(() => {
        localStorage.setItem('writerNotes', notesTextarea.value);
      }, 2000);
    });

    // Request notification permission
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Space to start/pause timer
      if (e.code === 'Space' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        if (isRunning && !isPaused) {
          pauseTimer();
        } else {
          startTimer();
        }
      }
      
      // R to reset timer
      if (e.key === 'r' && e.ctrlKey) {
        e.preventDefault();
        resetTimer();
      }
      
      // S to save notes
      if (e.key === 's' && e.ctrlKey) {
        e.preventDefault();
        saveNotes();
      }
    });

    // Initialize when page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>
